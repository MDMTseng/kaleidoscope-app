<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è¬èŠ±ç­’è½‰æ›å™¨</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: #0d0d1a; color: #fff; font-family: -apple-system, sans-serif; min-height: 100vh; }
  header { text-align: center; padding: 18px 16px 8px; }
  header h1 { font-size: 1.5rem; background: linear-gradient(135deg, #f093fb, #f5a623, #4facfe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  header p { color: #777; font-size: 0.8rem; margin-top: 3px; }
  .upload-area { margin: 10px 16px; border: 2px dashed #444; border-radius: 16px; padding: 20px 16px; text-align: center; cursor: pointer; background: #1a1a2e; transition: border-color 0.2s; }
  .upload-area.drag { border-color: #f093fb; }
  .upload-area .icon { font-size: 2rem; }
  .upload-area p { color: #aaa; margin-top: 6px; font-size: 0.85rem; }
  #fileInput { display: none; }
  .mode-wrap { margin: 10px 16px; }
  .mode-wrap label { font-size: 0.75rem; color: #888; margin-bottom: 6px; display: block; }
  .mode-btns { display: flex; gap: 6px; flex-wrap: wrap; }
  .mode-btn { flex: 1; min-width: 70px; padding: 8px 4px; border-radius: 10px; border: 2px solid #333; background: #111; color: #aaa; font-size: 0.75rem; cursor: pointer; text-align: center; transition: all 0.15s; line-height: 1.3; }
  .mode-btn.active { border-color: #f093fb; color: #f093fb; background: #2a1a2e; }
  .canvas-wrap { margin: 10px 16px; border-radius: 16px; overflow: hidden; background: #111; display: flex; align-items: center; justify-content: center; min-height: 280px; }
  canvas { max-width: 100%; display: block; }
  .controls { margin: 10px 16px; background: #1a1a2e; border-radius: 16px; padding: 14px; display: flex; flex-direction: column; gap: 12px; }
  .ctrl-row { display: flex; align-items: center; gap: 10px; }
  .ctrl-row label { font-size: 0.78rem; color: #bbb; min-width: 72px; }
  .ctrl-row input[type=range] { flex: 1; -webkit-appearance: none; height: 4px; border-radius: 2px; background: #333; outline: none; }
  .ctrl-row input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: linear-gradient(135deg, #f093fb, #4facfe); cursor: pointer; }
  .ctrl-row .val { font-size: 0.78rem; color: #f093fb; min-width: 34px; text-align: right; }
  .seg-btns { display: flex; gap: 6px; flex-wrap: wrap; }
  .seg-btn { flex: 1; min-width: 36px; padding: 7px 2px; border-radius: 8px; border: 2px solid #333; background: #111; color: #aaa; font-size: 0.85rem; cursor: pointer; text-align: center; transition: all 0.15s; }
  .seg-btn.active { border-color: #f093fb; color: #f093fb; background: #2a1a2e; }
  .btn-row { display: flex; gap: 10px; margin: 10px 16px 20px; }
  .btn { flex: 1; padding: 13px; border-radius: 14px; border: none; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: opacity 0.15s; }
  .btn:active { opacity: 0.7; }
  .btn-primary { background: linear-gradient(135deg, #f093fb, #4facfe); color: #fff; }
  .btn-secondary { background: #1a1a2e; color: #aaa; border: 1px solid #333; }
  .placeholder { color: #444; font-size: 0.9rem; }
  .anim-row { display: flex; align-items: center; justify-content: space-between; }
  .toggle { position: relative; width: 44px; height: 24px; }
  .toggle input { opacity: 0; width: 0; height: 0; }
  .slider { position: absolute; inset: 0; background: #333; border-radius: 24px; cursor: pointer; transition: .3s; }
  .slider:before { content: ''; position: absolute; width: 18px; height: 18px; left: 3px; top: 3px; background: #fff; border-radius: 50%; transition: .3s; }
  input:checked + .slider { background: linear-gradient(135deg, #f093fb, #4facfe); }
  input:checked + .slider:before { transform: translateX(20px); }
</style>
</head>
<body>
<header>
  <h1>ğŸ”® è¬èŠ±ç­’è½‰æ›å™¨</h1>
  <p>ä¸Šå‚³åœ–ç‰‡ï¼Œç”Ÿæˆç¾éº—çš„è¬èŠ±ç­’æ•ˆæœ</p>
</header>
<div class="upload-area" id="uploadArea">
  <div class="icon">ğŸ“·</div>
  <p>é»æ“Šä¸Šå‚³åœ–ç‰‡ / æ‹–æ›³è‡³æ­¤</p>
  <input type="file" id="fileInput" accept="image/*">
</div>
<div class="mode-wrap">
  <label>è¬èŠ±ç­’å½¢å¼</label>
  <div class="mode-btns" id="modeBtns">
    <div class="mode-btn active" data-mode="classic">ğŸ”® ç¶“å…¸<br>æ‰‡å½¢</div>
    <div class="mode-btn" data-mode="diamond">ğŸ’ è±å½¢<br>é¡å°„</div>
    <div class="mode-btn" data-mode="spiral">ğŸŒ€ èºæ—‹<br>æ—‹è½‰</div>
    <div class="mode-btn" data-mode="tunnel">ğŸ•³ï¸ éš§é“<br>ç¸®æ”¾</div>
    <div class="mode-btn" data-mode="star">â­ æ˜Ÿå½¢<br>æ”¾å°„</div>
    <div class="mode-btn" data-mode="tile">ğŸ”· ç£ç£š<br>å¹³é‹ª</div>
    <div class="mode-btn" data-mode="mandala">ğŸª· æ›¼é™€ç¾…<br>é¡å°„å°ç¨±</div>
    <div class="mode-btn" data-mode="sunflower">ğŸŒ» å‘æ—¥è‘µ<br>è²»æ°èºæ—‹</div>
    <div class="mode-btn" data-mode="corridor">ğŸŒ€ ç„¡ç›¡é¡å»Š<br>éè¿´ç¸®æ”¾</div>
    <div class="mode-btn" data-mode="rose">ğŸŒ¹ ç«ç‘°æ›²ç·š<br>ç¾…å¤šå°¼äº</div>
    <div class="mode-btn" data-mode="honeycomb">ğŸ èœ‚å·¢<br>å…­è§’å¹³é‹ª</div>
  </div>
</div>
<div class="canvas-wrap" id="canvasWrap">
  <p class="placeholder">è¬èŠ±ç­’æ•ˆæœå°‡é¡¯ç¤ºåœ¨é€™è£¡</p>
</div>
<div class="controls">
  <div class="ctrl-row">
    <label>å°ç¨±ç‰‡æ•¸</label>
    <div class="seg-btns" id="segBtns">
      <div class="seg-btn" data-v="4">4</div>
      <div class="seg-btn active" data-v="6">6</div>
      <div class="seg-btn" data-v="8">8</div>
      <div class="seg-btn" data-v="12">12</div>
      <div class="seg-btn" data-v="16">16</div>
    </div>
  </div>
  <div class="ctrl-row">
    <label>æ—‹è½‰è§’åº¦</label>
    <input type="range" id="rotRange" min="0" max="360" value="0">
    <span class="val" id="rotVal">0Â°</span>
  </div>
  <div class="ctrl-row">
    <label>ç¸®æ”¾</label>
    <input type="range" id="zoomRange" min="30" max="300" value="100">
    <span class="val" id="zoomVal">100%</span>
  </div>
  <div class="ctrl-row">
    <label>åç§» X</label>
    <input type="range" id="offXRange" min="-100" max="100" value="0">
    <span class="val" id="offXVal">0</span>
  </div>
  <div class="ctrl-row">
    <label>åç§» Y</label>
    <input type="range" id="offYRange" min="-100" max="100" value="0">
    <span class="val" id="offYVal">0</span>
  </div>
  <div class="ctrl-row anim-row">
    <label>è‡ªå‹•æ—‹è½‰</label>
    <label class="toggle"><input type="checkbox" id="animToggle"><span class="slider"></span></label>
  </div>
</div>
<div class="btn-row">
  <button class="btn btn-secondary" id="resetBtn">é‡ç½®</button>
  <button class="btn btn-primary" id="saveBtn">ğŸ’¾ å„²å­˜åœ–ç‰‡</button>
</div>
<script>
let img=null,segments=6,rotation=0,zoom=100,offX=0,offY=0;
let canvas,ctx,mode='classic',animId=null,animAngle=0;
const canvasWrap=document.getElementById('canvasWrap');
const uploadArea=document.getElementById('uploadArea');
const fileInput=document.getElementById('fileInput');
uploadArea.addEventListener('click',()=>fileInput.click());
uploadArea.addEventListener('dragover',e=>{e.preventDefault();uploadArea.classList.add('drag');});
uploadArea.addEventListener('dragleave',()=>uploadArea.classList.remove('drag'));
uploadArea.addEventListener('drop',e=>{e.preventDefault();uploadArea.classList.remove('drag');const f=e.dataTransfer.files[0];if(f)loadFile(f);});
fileInput.addEventListener('change',e=>{if(e.target.files[0])loadFile(e.target.files[0]);});
function loadFile(f){const url=URL.createObjectURL(f);const i=new Image();i.onload=()=>{img=i;initCanvas();draw();};i.src=url;}
function initCanvas(){canvasWrap.innerHTML='';const size=Math.min(window.innerWidth-32,480);canvas=document.createElement('canvas');canvas.width=canvas.height=size;ctx=canvas.getContext('2d');canvasWrap.appendChild(canvas);}
function draw(){if(!img||!canvas)return;ctx.clearRect(0,0,canvas.width,canvas.height);const r=rotation+animAngle;switch(mode){case 'classic':drawClassic(r);break;case 'diamond':drawDiamond(r);break;case 'spiral':drawSpiral(r);break;case 'tunnel':drawTunnel(r);break;case 'star':drawStar(r);break;case 'tile':drawTile(r);break;case 'mandala':drawMandala(r);break;case 'sunflower':drawSunflower(r);break;case 'corridor':drawCorridor(r);break;case 'rose':drawRose(r);break;case 'honeycomb':drawHoneycomb(r);break;}vignette();}
function imgScale(s){return(zoom/100)*(s/Math.min(img.width,img.height));}
function drawImg(sc,s,ox,oy,rot){const ix=-img.width/2*sc+ox;const iy=-img.height/2*sc+oy;if(rot)ctx.rotate(rot*Math.PI/180);ctx.drawImage(img,ix,iy,img.width*sc,img.height*sc);}
function drawClassic(r){const s=canvas.width;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();const sa=(Math.PI*2)/segments;const sc=imgScale(s);const ox=(offX/100)*s,oy=(offY/100)*s;for(let i=0;i<segments;i++){ctx.save();ctx.translate(s/2,s/2);ctx.rotate(i*sa);ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,s,-sa/2,sa/2);ctx.closePath();ctx.clip();if(i%2===1)ctx.scale(1,-1);drawImg(sc,s,ox,oy,r);ctx.restore();}ctx.restore();}
function drawDiamond(r){const s=canvas.width,h=s/2;const sc=imgScale(s);const ox=(offX/100)*s,oy=(offY/100)*s;const quads=[[1,1],[-1,1],[1,-1],[-1,-1]];ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();for(const[fx,fy]of quads){ctx.save();ctx.translate(s/2,s/2);ctx.scale(fx,fy);ctx.beginPath();ctx.rect(0,0,h,h);ctx.clip();drawImg(sc,s,ox,oy,r);ctx.restore();}ctx.restore();}
function drawSpiral(r){const s=canvas.width;const sc=imgScale(s);const ox=(offX/100)*s,oy=(offY/100)*s;const steps=segments;const angleStep=(Math.PI*2)/steps;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();for(let i=0;i<steps;i++){const decay=1-i*0.06;if(decay<=0)continue;ctx.save();ctx.translate(s/2,s/2);ctx.rotate(i*angleStep+r*Math.PI/180);ctx.scale(decay,decay);drawImg(sc,s,ox,oy,0);ctx.restore();}ctx.restore();}
function drawTunnel(r){const s=canvas.width;const sc=imgScale(s);const ox=(offX/100)*s,oy=(offY/100)*s;const rings=6;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();for(let i=rings;i>=0;i--){const t=i/rings;ctx.save();ctx.translate(s/2,s/2);ctx.rotate((r+i*30)*Math.PI/180);const ss=t*1.4;ctx.scale(ss,ss);if(i%2===0)ctx.scale(-1,1);drawImg(sc,s,ox,oy,0);ctx.restore();}ctx.restore();}
function drawStar(r){const s=canvas.width;const sc=imgScale(s)*1.2;const ox=(offX/100)*s,oy=(offY/100)*s;const n=segments;const sa=(Math.PI*2)/n;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();for(let i=0;i<n;i++){ctx.save();ctx.translate(s/2,s/2);ctx.rotate(i*sa+r*Math.PI/180);ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,s,-sa/2,sa/2);ctx.closePath();ctx.clip();if(i%2===0)ctx.scale(-1,1);else ctx.scale(1,-1);drawImg(sc,s,ox,oy,0);ctx.restore();}ctx.restore();}
function drawTile(r){const s=canvas.width;const tileSize=s/(segments<=6?3:4);const sc=(zoom/100)*tileSize/Math.min(img.width,img.height);const ox=(offX/100)*tileSize,oy=(offY/100)*tileSize;const cols=Math.ceil(s/tileSize)+1,rows=Math.ceil(s/tileSize)+1;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();for(let row=0;row<rows;row++){for(let col=0;col<cols;col++){ctx.save();ctx.translate(col*tileSize,row*tileSize);if(col%2===1){ctx.translate(tileSize,0);ctx.scale(-1,1);}if(row%2===1){ctx.translate(0,tileSize);ctx.scale(1,-1);}ctx.rotate(r*Math.PI/180);ctx.drawImage(img,ox-img.width*sc/2,oy-img.height*sc/2,img.width*sc,img.height*sc);ctx.restore();}}ctx.restore();}
function drawMandala(r){const s=canvas.width;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();const n=segments*2;const sa=Math.PI/segments;const sc=imgScale(s);const ox=(offX/100)*s,oy=(offY/100)*s;const rr=r*Math.PI/180;for(let i=0;i<n;i++){ctx.save();ctx.translate(s/2,s/2);ctx.rotate(i*sa+rr);ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,s,-sa/2,sa/2);ctx.closePath();ctx.clip();if(i%2===1)ctx.scale(-1,1);drawImg(sc,s,ox,oy,0);ctx.restore();}ctx.restore();}
function drawSunflower(r){const s=canvas.width;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();const N=segments*12;const ga=2.399963;const sc=imgScale(s)*0.13;const ox=(offX/100)*s*0.1,oy=(offY/100)*s*0.1;const rr=r*Math.PI/180;for(let i=N-1;i>=0;i--){const ang=i*ga+rr;const rad=Math.sqrt(i/N)*s*0.45;ctx.save();ctx.translate(s/2+Math.cos(ang)*rad,s/2+Math.sin(ang)*rad);ctx.rotate(ang+Math.PI/2);ctx.drawImage(img,ox-img.width*sc/2,oy-img.height*sc/2,img.width*sc,img.height*sc);ctx.restore();}ctx.restore();}
function drawCorridor(r){const s=canvas.width;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();const levels=9;const shrink=0.72;const twist=(Math.PI*2)/segments;const sc=imgScale(s);const ox=(offX/100)*s,oy=(offY/100)*s;const rr=r*Math.PI/180;const sa=(Math.PI*2)/segments;for(let lv=0;lv<=levels;lv++){const scale=Math.pow(shrink,lv);for(let i=0;i<segments;i++){ctx.save();ctx.translate(s/2,s/2);ctx.rotate(i*sa+lv*twist+rr);ctx.scale(scale,scale);ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,s,-sa/2,sa/2);ctx.closePath();ctx.clip();if(lv%2===0)ctx.scale(1,-1);drawImg(sc,s,ox,oy,0);ctx.restore();}}ctx.restore();}
function drawRose(r){const s=canvas.width;const k=Math.max(2,Math.floor(segments/2));const petals=(k%2===0)?2*k:k;const maxR=s*0.45;const sc=imgScale(s);const ox=(offX/100)*s,oy=(offY/100)*s;const rr=r*Math.PI/180;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();const steps=60;for(let p=0;p<petals;p++){ctx.save();ctx.translate(s/2,s/2);ctx.rotate(p*(Math.PI*2/petals)+rr);ctx.beginPath();ctx.moveTo(0,0);for(let j=0;j<=steps;j++){const theta=-Math.PI/(2*k)+j*Math.PI/(k*steps);const rad=Math.cos(k*theta)*maxR;ctx.lineTo(Math.cos(theta)*rad,Math.sin(theta)*rad);}ctx.closePath();ctx.clip();ctx.translate(maxR*0.5,0);if(p%2===1)ctx.scale(1,-1);drawImg(sc,s,ox,oy,0);ctx.restore();}ctx.restore();}
function drawHoneycomb(r){const s=canvas.width;const tileW=s/(segments<=6?3:4);const tileH=tileW*Math.sqrt(3)/2;const sc=(zoom/100)*tileW/Math.min(img.width,img.height);const ox=(offX/100)*tileW,oy=(offY/100)*tileH;const cols=Math.ceil(s/tileW)+2,rows=Math.ceil(s/tileH)+2;ctx.save();ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.clip();for(let row=0;row<rows;row++){for(let col=0;col<cols;col++){const cx=col*tileW+(row%2===1?tileW/2:0);const cy=row*tileH;ctx.save();ctx.translate(cx,cy);if(col%2===1){ctx.translate(tileW,0);ctx.scale(-1,1);}if(row%2===1){ctx.translate(0,tileH);ctx.scale(1,-1);}ctx.rotate(r*Math.PI/180);ctx.drawImage(img,ox-img.width*sc/2,oy-img.height*sc/2,img.width*sc,img.height*sc);ctx.restore();}}ctx.restore();}
function vignette(){if(!canvas)return;const s=canvas.width;const g=ctx.createRadialGradient(s/2,s/2,s*0.35,s/2,s/2,s/2);g.addColorStop(0,'rgba(0,0,0,0)');g.addColorStop(1,'rgba(0,0,0,0.4)');ctx.fillStyle=g;ctx.beginPath();ctx.arc(s/2,s/2,s/2,0,Math.PI*2);ctx.fill();}
document.getElementById('modeBtns').addEventListener('click',e=>{const btn=e.target.closest('.mode-btn');if(!btn)return;document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');mode=btn.dataset.mode;draw();});
document.getElementById('segBtns').addEventListener('click',e=>{const btn=e.target.closest('.seg-btn');if(!btn)return;document.querySelectorAll('.seg-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');segments=+btn.dataset.v;draw();});
function bindRange(id,valId,suffix,setter){const el=document.getElementById(id),vEl=document.getElementById(valId);el.addEventListener('input',()=>{const v=+el.value;vEl.textContent=v+suffix;setter(v);draw();});}
bindRange('rotRange','rotVal','Â°',v=>rotation=v);
bindRange('zoomRange','zoomVal','%',v=>zoom=v);
bindRange('offXRange','offXVal','',v=>offX=v);
bindRange('offYRange','offYVal','',v=>offY=v);
document.getElementById('animToggle').addEventListener('change',e=>{if(e.target.checked){let last=null;function loop(ts){if(last)animAngle+=(ts-last)*0.03;last=ts;draw();animId=requestAnimationFrame(loop);}animId=requestAnimationFrame(loop);}else{cancelAnimationFrame(animId);animAngle=0;draw();}});
document.getElementById('resetBtn').addEventListener('click',()=>{rotation=0;zoom=100;offX=0;offY=0;['rotRange','zoomRange','offXRange','offYRange'].forEach((id,i)=>{document.getElementById(id).value=[0,100,0,0][i];});document.getElementById('rotVal').textContent='0Â°';document.getElementById('zoomVal').textContent='100%';document.getElementById('offXVal').textContent='0';document.getElementById('offYVal').textContent='0';segments=6;document.querySelectorAll('.seg-btn').forEach(b=>b.classList.toggle('active',b.dataset.v==='6'));draw();});
document.getElementById('saveBtn').addEventListener('click',()=>{if(!canvas)return;const a=document.createElement('a');a.download='kaleidoscope.png';a.href=canvas.toDataURL('image/png');a.click();});
</script>
</body>
</html>